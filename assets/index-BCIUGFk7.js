import{c as A,f as x,aa as he,ac as R,d as J,ar as _,as as D,n as L,r as E,at as ge,g as T,a6 as le,b as ce,au as be,a9 as ie,e as g,p as se,U as W,t as ue,j as B,u as Oe,av as pe,h as q,aw as Te,a8 as X,i as ee,m as ye,R as ke,ax as xe,k as z,ay as re}from"./index-D9wYTDFn.js";const[Ce,p,te]=A("picker"),me=e=>e.find(a=>!a.disabled)||e[0];function we(e,a){const n=e[0];if(n){if(Array.isArray(n))return"multiple";if(a.children in n)return"cascade"}return"default"}function $(e,a){a=R(a,0,e.length);for(let n=a;n<e.length;n++)if(!e[n].disabled)return n;for(let n=a-1;n>=0;n--)if(!e[n].disabled)return n;return 0}const ne=(e,a,n)=>a!==void 0&&e.some(i=>i[n.value]===a);function Z(e,a,n){const i=e.findIndex(d=>d[n.value]===a),l=$(e,i);return e[l]}function Ee(e,a,n){const i=[];let l={[a.children]:e},d=0;for(;l&&l[a.children];){const m=l[a.children],f=n.value[d];if(l=he(f)?Z(m,f,a):void 0,!l&&m.length){const r=me(m)[a.value];l=Z(m,r,a)}d++,i.push(m)}return i}function Se(e){const{transform:a}=window.getComputedStyle(e),n=a.slice(7,a.length-1).split(", ")[5];return Number(n)}function Pe(e){return x({text:"text",value:"value",children:"children"},e)}const ae=200,oe=300,Ie=15,[de,G]=A("picker-column"),fe=Symbol(de);var De=J({name:de,props:{value:L,fields:_(Object),options:D(),readonly:Boolean,allowHtml:Boolean,optionHeight:_(Number),swipeDuration:_(L),visibleOptionNum:_(L)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:n}){let i,l,d,m,f;const r=E(),b=E(),v=E(0),h=E(0),y=ge(),C=()=>e.options.length,M=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,k=c=>{let u=$(e.options,c);const t=-u*e.optionHeight,o=()=>{u>C()-1&&(u=$(e.options,c));const s=e.options[u][e.fields.value];s!==e.value&&a("change",s)};i&&t!==v.value?f=o:o(),v.value=t},O=()=>e.readonly||!e.options.length,K=c=>{i||O()||(f=null,h.value=ae,k(c),a("clickOption",e.options[c]))},w=c=>R(Math.round(-c/e.optionHeight),0,C()-1),H=T(()=>w(v.value)),U=(c,u)=>{const t=Math.abs(c/u);c=v.value+t/.003*(c<0?-1:1);const o=w(c);h.value=+e.swipeDuration,k(o)},S=()=>{i=!1,h.value=0,f&&(f(),f=null)},Y=c=>{if(!O()){if(y.start(c),i){const u=Se(b.value);v.value=Math.min(0,u-M())}h.value=0,l=v.value,d=Date.now(),m=l,f=null}},j=c=>{if(O())return;y.move(c),y.isVertical()&&(i=!0,se(c,!0));const u=R(l+y.deltaY.value,-(C()*e.optionHeight),e.optionHeight),t=w(u);t!==H.value&&a("scrollInto",e.options[t]),v.value=u;const o=Date.now();o-d>oe&&(d=o,m=u)},P=()=>{if(O())return;const c=v.value-m,u=Date.now()-d;if(u<oe&&Math.abs(c)>Ie){U(c,u);return}const o=w(v.value);h.value=ae,k(o),setTimeout(()=>{i=!1},0)},N=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((u,t)=>{const o=u[e.fields.text],{disabled:s}=u,V=u[e.fields.value],I={role:"button",style:c,tabindex:s?-1:0,class:[G("item",{disabled:s,selected:V===e.value}),u.className],onClick:()=>K(t)},ve={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:o};return g("li",I,[n.option?n.option(u,t):g("div",ve,null)])})};return le(fe),ce({stopMomentum:S}),be(()=>{const c=i?Math.floor(-v.value/e.optionHeight):e.options.findIndex(o=>o[e.fields.value]===e.value),u=$(e.options,c),t=-u*e.optionHeight;i&&u<c&&S(),v.value=t}),ie("touchmove",j,{target:r}),()=>g("div",{ref:r,class:G(),onTouchstartPassive:Y,onTouchend:P,onTouchcancel:P},[g("ul",{ref:b,style:{transform:`translate3d(0, ${v.value+M()}px, 0)`,transitionDuration:`${h.value}ms`,transitionProperty:h.value?"all":"none"},class:G("wrapper"),onTransitionend:S},[N()])])}});const[Me]=A("picker-toolbar"),F={title:String,cancelButtonText:String,confirmButtonText:String},He=["cancel","confirm","title","toolbar"],Ne=Object.keys(F);var Ve=J({name:Me,props:F,emits:["confirm","cancel"],setup(e,{emit:a,slots:n}){const i=()=>{if(n.title)return n.title();if(e.title)return g("div",{class:[p("title"),"van-ellipsis"]},[e.title])},l=()=>a("cancel"),d=()=>a("confirm"),m=()=>{var r;const b=(r=e.cancelButtonText)!=null?r:te("cancel");if(!(!n.cancel&&!b))return g("button",{type:"button",class:[p("cancel"),W],onClick:l},[n.cancel?n.cancel():b])},f=()=>{var r;const b=(r=e.confirmButtonText)!=null?r:te("confirm");if(!(!n.confirm&&!b))return g("button",{type:"button",class:[p("confirm"),W],onClick:d},[n.confirm?n.confirm():b])};return()=>g("div",{class:p("toolbar")},[n.toolbar?n.toolbar():[m(),i(),f()]])}});const[_e]=A("picker-group"),Be=Symbol(_e);x({tabs:D(),activeTab:B(0),nextStepText:String,showToolbar:ue},F);const Q=x({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:B(44),showToolbar:ue,swipeDuration:B(1e3),visibleOptionNum:B(6)},F),$e=x({},Q,{columns:D(),modelValue:D(),toolbarPosition:ke("top"),columnsFieldNames:Object});var Fe=J({name:Ce,props:$e,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:n}){const i=E(),l=E(e.modelValue.slice(0)),{parent:d}=le(Be),{children:m,linkChildren:f}=Oe(fe);f();const r=T(()=>Pe(e.columnsFieldNames)),b=T(()=>pe(e.optionHeight)),v=T(()=>we(e.columns,r.value)),h=T(()=>{const{columns:t}=e;switch(v.value){case"multiple":return t;case"cascade":return Ee(t,r.value,l);default:return[t]}}),y=T(()=>h.value.some(t=>t.length)),C=T(()=>h.value.map((t,o)=>Z(t,l.value[o],r.value))),M=T(()=>h.value.map((t,o)=>t.findIndex(s=>s[r.value.value]===l.value[o]))),k=(t,o)=>{if(l.value[t]!==o){const s=l.value.slice(0);s[t]=o,l.value=s}},O=()=>({selectedValues:l.value.slice(0),selectedOptions:C.value,selectedIndexes:M.value}),K=(t,o)=>{k(o,t),v.value==="cascade"&&l.value.forEach((s,V)=>{const I=h.value[V];ne(I,s,r.value)||k(V,I.length?I[0][r.value.value]:void 0)}),X(()=>{a("change",x({columnIndex:o},O()))})},w=(t,o)=>{const s={columnIndex:o,currentOption:t};a("clickOption",x(O(),s)),a("scrollInto",s)},H=()=>{m.forEach(o=>o.stopMomentum());const t=O();return X(()=>{const o=O();a("confirm",o)}),t},U=()=>a("cancel",O()),S=()=>h.value.map((t,o)=>g(De,{value:l.value[o],fields:r.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:b.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:s=>K(s,o),onClickOption:s=>w(s,o),onScrollInto:s=>{a("scrollInto",{currentOption:s,columnIndex:o})}},{option:n.option})),Y=t=>{if(y.value){const o={height:`${b.value}px`},s={backgroundSize:`100% ${(t-b.value)/2}px`};return[g("div",{class:p("mask"),style:s},null),g("div",{class:[xe,p("frame")],style:o},null)]}},j=()=>{const t=b.value*+e.visibleOptionNum,o={height:`${t}px`};return!e.loading&&!y.value&&n.empty?n.empty():g("div",{ref:i,class:p("columns"),style:o},[S(),Y(t)])},P=()=>{if(e.showToolbar&&!d)return g(Ve,ye(ee(e,Ne),{onConfirm:H,onCancel:U}),ee(n,He))},N=t=>{t.forEach((o,s)=>{o.length&&!ne(o,l.value[s],r.value)&&k(s,me(o)[r.value.value])})};q(h,t=>N(t),{immediate:!0});let c;return q(()=>e.modelValue,t=>{!z(t,l.value)&&!z(t,c)&&(l.value=t.slice(0),c=t.slice(0)),e.modelValue.length===0&&N(h.value)},{deep:!0}),q(l,t=>{z(t,e.modelValue)||(c=t.slice(0),a("update:modelValue",c))},{immediate:!0}),ie("touchmove",se,{target:i}),ce({confirm:H,getSelectedOptions:()=>C.value}),()=>{var t,o;return g("div",{class:p()},[e.toolbarPosition==="top"?P():null,e.loading?g(Te,{class:p("loading")},null):null,(t=n["columns-top"])==null?void 0:t.call(n),j(),(o=n["columns-bottom"])==null?void 0:o.call(n),e.toolbarPosition==="bottom"?P():null])}}});const Ke=x({},Q,{modelValue:D(),filter:Function,formatter:{type:Function,default:(e,a)=>a}}),Ue=Object.keys(Q);function Re(e,a){if(e<0)return[];const n=Array(e);let i=-1;for(;++i<e;)n[i]=a(i);return n}const Ye=(e,a)=>32-new Date(e,a-1,32).getDate(),je=(e,a,n,i,l,d)=>{const m=Re(a-e+1,f=>{const r=re(e+f);return i(n,{text:r,value:r})});return l?l(n,m,d):m},Le=(e,a)=>e.map((n,i)=>{const l=a[i];if(l.length){const d=+l[0].value,m=+l[l.length-1].value;return re(R(+n,d,m))}return n});export{Fe as a,Ye as b,Le as f,je as g,Ue as p,Ke as s};
